<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title><?= $name ?> | <?= $action ?></title>

    <? if ($redirect) { ?>
    <meta http-equiv="refresh" content="2; URL=<?= $redirect ?>">
    <? } ?>

    <? foreach ($headElements as $element) { ?>
    <?= $element ?>

    <? } ?>

</head>
<body>

<?= $menu ?>

<div class="container">

    <? if ($breadcrumbs) { ?>
    <ol class="breadcrumb">
        <? foreach ($breadcrumbs as $crumb) { ?>
        <li><a href="<?= $crumb[target] ?>"><?= $crumb[caption] ?></a></li>
        <? } ?>
    </ol>
    <? } ?>

    <? if ($error) { ?>
    <div class="alert alert-danger"><?= $error ?></div>
    <? } ?>

    <? if ($success) { ?>
    <div class="alert alert-success">Action "<?= $action ?>" was successfully executed</div>
    <? } ?>

    <? if ($redirect) { ?>
    <div class="alert alert-info">You are redirected. Please wait or <a href="<?= $redirect ?>">click here</a></div>
    <? } else { ?>

    <form id="form" method="post" action="?" enctype="multipart/form-data">
    <div class="panel panel-primary">
        <div class="panel-heading">
            <h1 class="panel-title" style="font-size: 22pt"><a href="<?= $current ?>"><?= $action ?></a></h1>
        </div>

        <? if ($fields || $description) { ?>
        <div class="panel-body">
            <? if ($description) { ?>
            <div class="well"><?= $description ?></div>
            <? } ?>

            <? foreach ($fields as $field) { ?>
            <div class="form-group">
                <label>
                    <?= $field[caption] . ($field[required] ? '*' : '') ?>
                </label>
                <? if ($field[description]) { ?>
                <a class="description">
                    <span class="glyphicon glyphicon-question-sign"></span>
                </a>

                <div class="description-content sr-only"><?= $field[description] ?></div>
                <? } ?>
                <?= $field[control] ?>
            </div>
            <? } ?>
        </div>
        <? } ?>

        <? if ($fields) { ?>
        <div class="panel-footer">
            <input type="submit" class="btn btn-primary" value="Execute">

            <? if ($missing) { ?>
            <a href="javascript:history.back()" class="btn btn-default">Back</a>
            <? } ?>
        </div>
        <? } ?>
    </div>
    </form>

    <? } ?>

    <? if ($output) { ?>
    <div><?= $output ?></div>
    <? } ?>

    <? if ($missing) { ?>
    <script>
        document.onkeyup = function () {
            window.onbeforeunload = function () {
                return "If you close this page, you will lose unsaved changes.";
            };
        };
    </script>
    <? } ?>

    <script>
        $(function () {
            $('.description').popover({
                trigger: 'hover',
                delay: {show: 100, hide: 1000},
                html: true,
                placement: 'auto top',
                content: function () {
                    return $(this).siblings('.description-content').html();
                }
            });
        });

        document.onsubmit = function () {
            window.onbeforeunload = function () {
            };

            document.getElementById('form').style.opacity = 0.5;
            document.onsubmit = function () {
                return false;
            };
            return true;
        };
    </script>
</div>

</body>
</html>
