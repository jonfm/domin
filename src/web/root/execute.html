<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>domin | <?= $action ?></title>

    <? if ($redirect) { ?>
    <meta http-equiv="refresh" content="2; URL=<?= $redirect ?>">
    <? } ?>

<? foreach ($headElements as $element) { ?>
    <?= $element ?>

<? } ?>

</head>
<body>

<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="<?= $baseUrl ?>">domin</a>
        </div>

        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <? foreach ($menuItems as $item) { ?>
                    <? if (isset($item[items])) { ?>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><?= $item[caption] ?> <span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <? foreach ($item[items] as $subItem) { ?>
                                <li><a href="<?= $subItem[target] ?>"><?= $subItem[caption] ?></a></li>
                                <? } ?>
                            </ul>
                        </li>
                    <? } else { ?>
                        <li><a href="<?= $item[target] ?>"><?= $item[caption] ?></a></li>
                    <? } ?>
                <? } ?>
            </ul>
        </div>
    </div>
</nav>

<div class="container">

    <? if ($breadcrumbs) { ?>
    <ol class="breadcrumb">
        <? foreach ($breadcrumbs as $crumb) { ?>
        <li><a href="<?= $crumb[target] ?>"><?= $crumb[caption] ?></a></li>
        <? } ?>
    </ol>
    <? } ?>

    <? if ($error) { ?>
    <div class="alert alert-danger"><?= $error ?></div>
    <? } ?>

    <? if ($success) { ?>
    <div class="alert alert-success">Action "<?= $action ?>" was successfully executed</div>
    <? } ?>

    <? if ($redirect) { ?>
    <div class="alert alert-info">You are redirected. Please wait or <a href="<?= $redirect ?>">click here</a></div>
    <? } ?>

    <div class="panel panel-primary">
        <div class="panel-heading">
            <h1 class="panel-title"><?= $action ?></h1>
        </div>
        <div class="panel-body">
            <form method="post" action="?" enctype="multipart/form-data">
                <? foreach ($fields as $field) { ?>
                <div class="form-group">
                    <label><?= $field[caption] . ($field[required] ? '*' : '') ?></label>
                    <?= $field[control] ?>
                </div>
                <? } ?>
                <input type="submit" class="btn btn-primary" value="Execute">

                <? if ($missing) { ?>
                <a href="javascript:history.back()" class="btn btn-default">Back</a>
                <? } ?>
            </form>
        </div>
    </div>

    <? if ($output) { ?>
    <div><?= $output ?></div>
    <? } ?>

    <? if ($missing) { ?>
    <script property="isPreparing">
        document.onkeyup = function () {
            window.onbeforeunload = function () {
                return "If you close this page, you will lose unsaved changes.";
            };
        };
        document.onsubmit = function () {
            window.onbeforeunload = function () {};
        };
    </script>
    <? } ?>
</div>

</body>
</html>
